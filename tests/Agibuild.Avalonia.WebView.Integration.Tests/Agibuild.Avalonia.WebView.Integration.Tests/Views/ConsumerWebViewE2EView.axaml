<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:Agibuild.Avalonia.WebView.Integration.Tests.ViewModels"
             xmlns:agw="using:Agibuild.Avalonia.WebView"
             mc:Ignorable="d"
             x:Class="Agibuild.Avalonia.WebView.Integration.Tests.Views.ConsumerWebViewE2EView"
             x:DataType="vm:ConsumerWebViewE2EViewModel">

  <DockPanel Margin="8">

    <!-- Top: Status bar -->
    <StackPanel DockPanel.Dock="Top" Spacing="4" Margin="0,0,0,4">
      <TextBlock Text="Consumer WebView E2E" FontSize="16" FontWeight="Bold" />
      <TextBlock Text="{Binding Status}" Foreground="Gray" />
    </StackPanel>

    <!-- Top: Navigation toolbar -->
    <Grid DockPanel.Dock="Top" ColumnDefinitions="Auto,Auto,Auto,Auto,Auto,*,Auto,Auto" Margin="0,0,0,4">
      <!-- Back / Forward / Refresh / Stop -->
      <Button Grid.Column="0" Content="â—€" ToolTip.Tip="Back"
              Command="{Binding GoBackCommand}"
              IsEnabled="{Binding CanGoBack}"
              MinWidth="36" HorizontalContentAlignment="Center" />
      <Button Grid.Column="1" Content="â–¶" ToolTip.Tip="Forward"
              Command="{Binding GoForwardCommand}"
              IsEnabled="{Binding CanGoForward}"
              Margin="2,0,0,0" MinWidth="36" HorizontalContentAlignment="Center" />
      <Button Grid.Column="2" Content="âŸ³" ToolTip.Tip="Refresh"
              Command="{Binding DoRefreshCommand}"
              Margin="2,0,0,0" MinWidth="36" HorizontalContentAlignment="Center" />
      <Button Grid.Column="3" Content="âœ•" ToolTip.Tip="Stop"
              Command="{Binding DoStopCommand}"
              Margin="2,0,4,0" MinWidth="36" HorizontalContentAlignment="Center" />

      <!-- Loading indicator -->
      <TextBlock Grid.Column="4" Text="â³ Loadingâ€¦"
                 IsVisible="{Binding IsPageLoading}"
                 VerticalAlignment="Center" Foreground="DodgerBlue"
                 Margin="0,0,8,0" />

      <!-- Address bar -->
      <TextBox Grid.Column="5"
               Text="{Binding AddressText, Mode=TwoWay}"
               Watermark="Enter URL and press Enter"
               KeyDown="OnAddressKeyDown" />
      <Button Grid.Column="6" Content="Go" Margin="4,0,0,0"
              Command="{Binding GoToAddressCommand}" />

      <!-- Home button -->
      <Button Grid.Column="7" Content="ðŸ " ToolTip.Tip="Home (bing.com)"
              Command="{Binding GoHomeCommand}"
              Margin="2,0,0,0" MinWidth="36" HorizontalContentAlignment="Center" />
    </Grid>

    <!-- Bottom: status line -->
    <TextBlock DockPanel.Dock="Bottom"
               Text="E2E target: bing.com | Use toolbar for manual testing, left panel for JS/HTML/E2E"
               Margin="0,4,0,0" Foreground="Gray" FontSize="11" />

    <!-- Main area: left panel + splitter + right WebView -->
    <Grid ColumnDefinitions="280,Auto,*">

      <!-- Left: controls panel -->
      <DockPanel Grid.Column="0">

        <!-- E2E button -->
        <Button DockPanel.Dock="Top" Content="â–¶ Run E2E Tests"
                Command="{Binding RunAllCommand}" Margin="0,0,0,4" />

        <!-- JS Execution panel -->
        <Border DockPanel.Dock="Top" BorderThickness="1" BorderBrush="LightGray"
                CornerRadius="4" Padding="4" Margin="0,0,0,4">
          <StackPanel Spacing="4">
            <TextBlock Text="JavaScript" FontWeight="SemiBold" FontSize="12" />
            <TextBox Text="{Binding ScriptInput, Mode=TwoWay}"
                     Watermark="e.g. document.title"
                     AcceptsReturn="True" MinHeight="48"
                     FontFamily="Menlo,Consolas,monospace" FontSize="11"
                     KeyDown="OnScriptKeyDown" />
            <Grid ColumnDefinitions="*,Auto">
              <TextBlock Grid.Column="0" Text="{Binding ScriptResult}"
                         FontFamily="Menlo,Consolas,monospace" FontSize="11"
                         Foreground="Green" TextWrapping="Wrap" />
              <Button Grid.Column="1" Content="Run" MinWidth="50"
                      Command="{Binding RunScriptCommand}" />
            </Grid>
          </StackPanel>
        </Border>

        <!-- Load HTML panel -->
        <Border DockPanel.Dock="Top" BorderThickness="1" BorderBrush="LightGray"
                CornerRadius="4" Padding="4" Margin="0,0,0,4">
          <StackPanel Spacing="4">
            <TextBlock Text="Load HTML" FontWeight="SemiBold" FontSize="12" />
            <TextBox Text="{Binding HtmlInput, Mode=TwoWay}"
                     Watermark="&lt;html&gt;&lt;body&gt;Hello&lt;/body&gt;&lt;/html&gt;"
                     AcceptsReturn="True" MinHeight="48"
                     FontFamily="Menlo,Consolas,monospace" FontSize="11" />
            <Button Content="Load HTML" HorizontalAlignment="Right"
                    Command="{Binding LoadHtmlCommand}" />
          </StackPanel>
        </Border>

        <!-- Log header + clear -->
        <Grid DockPanel.Dock="Top" ColumnDefinitions="*,Auto" Margin="0,0,0,2">
          <TextBlock Grid.Column="0" Text="Log:" FontWeight="Bold" />
          <Button Grid.Column="1" Content="Clear" FontSize="11" Padding="8,2"
                  Command="{Binding ClearLogCommand}" />
        </Grid>

        <!-- Log output -->
        <TextBox IsReadOnly="True"
                 Text="{Binding Log}"
                 FontFamily="Menlo,Consolas,monospace" FontSize="11"
                 TextWrapping="Wrap"
                 AcceptsReturn="True" />
      </DockPanel>

      <!-- GridSplitter -->
      <GridSplitter Grid.Column="1" Width="6"
                    Background="Transparent"
                    ResizeDirection="Columns" />

      <!-- Right: WebView fills remaining space -->
      <Border Grid.Column="2" BorderThickness="1" BorderBrush="Gray">
        <agw:WebView x:Name="WebViewControl" />
      </Border>
    </Grid>
  </DockPanel>
</UserControl>
