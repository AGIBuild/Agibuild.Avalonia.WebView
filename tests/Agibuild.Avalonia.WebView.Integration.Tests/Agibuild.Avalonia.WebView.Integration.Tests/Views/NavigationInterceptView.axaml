<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:Agibuild.Avalonia.WebView.Integration.Tests.ViewModels"
             xmlns:agw="using:Agibuild.Avalonia.WebView"
             mc:Ignorable="d"
             x:Class="Agibuild.Avalonia.WebView.Integration.Tests.Views.NavigationInterceptView"
             x:DataType="vm:NavigationInterceptViewModel"
             Background="{StaticResource SurfaceBgBrush}">

  <DockPanel>

    <!-- ════════════ Toolbar ════════════ -->
    <Border DockPanel.Dock="Top" Background="White"
            BorderThickness="0,0,0,1" BorderBrush="{StaticResource BorderDefaultBrush}"
            Padding="6,4">
      <Grid ColumnDefinitions="Auto,Auto,*,Auto,Auto">
        <ToggleButton x:Name="LogToggle" Grid.Column="0"
                      Content="&#x2630;" ToolTip.Tip="Log"
                      FontSize="16" Padding="8,6"
                      Background="Transparent" BorderThickness="0"
                      CornerRadius="8" VerticalAlignment="Center" />

        <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8"
                    VerticalAlignment="Center" Margin="8,0">
          <TextBlock Text="&#x1F6E1;" FontSize="18" VerticalAlignment="Center" />
          <TextBlock Text="Nav Intercept" FontWeight="SemiBold" FontSize="14"
                     Foreground="{StaticResource TextPrimaryBrush}" />
        </StackPanel>

        <!-- Toggle interception on/off -->
        <StackPanel Grid.Column="3" Orientation="Horizontal" Spacing="6"
                    VerticalAlignment="Center" Margin="0,0,8,0">
          <TextBlock Text="Intercept" Classes="caption" VerticalAlignment="Center" />
          <ToggleSwitch x:Name="InterceptSwitch"
                        IsChecked="{Binding IsInterceptionEnabled}"
                        OffContent="" OnContent=""
                        Padding="0" Margin="0" />
        </StackPanel>

        <Button Grid.Column="4" Content="&#x21BB; Reset" FontSize="12"
                Padding="10,6" CornerRadius="8"
                Command="{Binding ReloadTestPageCommand}" />
      </Grid>
    </Border>

    <!-- ════════════ Status bar ════════════ -->
    <Border DockPanel.Dock="Bottom" Background="White"
            BorderThickness="0,1,0,0" BorderBrush="{StaticResource BorderDefaultBrush}"
            Padding="8,4">
      <Border CornerRadius="4" Padding="6,2" Background="#F1F5F9">
        <TextBlock Text="{Binding Status}" Classes="caption" />
      </Border>
    </Border>

    <!-- ════════════ Main area ════════════ -->
    <Panel>

      <!-- WebView -->
      <Border x:Name="WebViewContainer" ClipToBounds="True">
        <agw:WebView x:Name="WebViewControl" />
      </Border>

      <!-- ════════ Intercept Confirmation Overlay ════════ -->
      <!-- Backdrop -->
      <Border IsVisible="{Binding IsInterceptDialogVisible}"
              Background="#60000000" ZIndex="20" />

      <!-- Dialog card (centered) -->
      <Border IsVisible="{Binding IsInterceptDialogVisible}"
              ZIndex="21"
              HorizontalAlignment="Center" VerticalAlignment="Center"
              MaxWidth="360" MinWidth="280"
              Background="White" CornerRadius="16"
              Padding="0">
        <StackPanel>
          <!-- Header -->
          <Border CornerRadius="16,16,0,0" Padding="20,16">
            <Border.Background>
              <LinearGradientBrush StartPoint="0%,50%" EndPoint="100%,50%">
                <GradientStop Color="#F59E0B" Offset="0" />
                <GradientStop Color="#EF4444" Offset="1" />
              </LinearGradientBrush>
            </Border.Background>
            <StackPanel Spacing="4">
              <TextBlock Text="&#x26A0;  Navigation Intercepted"
                         FontSize="16" FontWeight="Bold" Foreground="White" />
              <TextBlock Text="A page is trying to navigate away."
                         FontSize="12" Foreground="#FFFFFFCC" />
            </StackPanel>
          </Border>

          <!-- URL display -->
          <Border Padding="20,16" Background="#FFFBEB">
            <StackPanel Spacing="6">
              <TextBlock Text="TARGET URL" Classes="section-label" />
              <Border Background="White" CornerRadius="6" Padding="10,8"
                      BorderThickness="1" BorderBrush="{StaticResource BorderDefaultBrush}">
                <TextBlock Text="{Binding InterceptedUrl}"
                           FontFamily="Menlo,Consolas,monospace" FontSize="12"
                           TextWrapping="Wrap" Foreground="{StaticResource TextPrimaryBrush}" />
              </Border>
            </StackPanel>
          </Border>

          <!-- Action buttons -->
          <StackPanel Spacing="8" Margin="20,16">
            <Button Content="&#x2705;  Allow Navigation"
                    Command="{Binding AllowNavigationCommand}"
                    HorizontalAlignment="Stretch"
                    HorizontalContentAlignment="Center"
                    Background="{StaticResource BrandSuccessBrush}"
                    Foreground="White" FontWeight="SemiBold"
                    CornerRadius="8" Padding="14,10" FontSize="14"
                    BorderThickness="0" />

            <Button Content="&#x1F6E1;  Go to Safe Page (example.com)"
                    Command="{Binding GoToSafePageCommand}"
                    HorizontalAlignment="Stretch"
                    HorizontalContentAlignment="Center"
                    Background="{StaticResource BrandPrimaryBrush}"
                    Foreground="White" FontWeight="SemiBold"
                    CornerRadius="8" Padding="14,10" FontSize="14"
                    BorderThickness="0" />

            <Button Content="&#x1F6AB;  Block (Stay Here)"
                    Command="{Binding BlockNavigationCommand}"
                    HorizontalAlignment="Stretch"
                    HorizontalContentAlignment="Center"
                    Background="#FEE2E2" Foreground="#DC2626"
                    FontWeight="SemiBold"
                    CornerRadius="8" Padding="14,10" FontSize="14"
                    BorderThickness="1" BorderBrush="#FECACA" />
          </StackPanel>
        </StackPanel>
      </Border>

      <!-- ════════ Log Drawer Overlay ════════ -->
      <Border IsVisible="{Binding #LogToggle.IsChecked}"
              Background="#40000000" ZIndex="10"
              PointerPressed="OnOverlayDismiss" />

      <Border IsVisible="{Binding #LogToggle.IsChecked}"
              HorizontalAlignment="Left" Width="300"
              Background="White" ZIndex="11"
              BorderThickness="0,0,1,0" BorderBrush="{StaticResource BorderDefaultBrush}">
        <DockPanel>
          <Border DockPanel.Dock="Top" Padding="16,12">
            <Grid ColumnDefinitions="*,Auto">
              <StackPanel Spacing="2">
                <TextBlock Text="Intercept Log" Classes="subheading" />
                <TextBlock Text="All navigation decisions" Classes="caption" />
              </StackPanel>
              <Button Grid.Column="1" Classes="toolbar-btn"
                      Content="&#x2715;" FontSize="14"
                      Click="OnCloseLogPanel" />
            </Grid>
          </Border>
          <Border DockPanel.Dock="Top" Height="1" Background="{StaticResource BorderDefaultBrush}" />
          <DockPanel Margin="12,8,12,12">
            <Button DockPanel.Dock="Top" Content="Clear Log" FontSize="11"
                    Padding="8,4" CornerRadius="6" HorizontalAlignment="Right"
                    Margin="0,0,0,8"
                    Command="{Binding ClearLogCommand}" />
            <TextBox IsReadOnly="True" Classes="mono"
                     Text="{Binding Log}"
                     TextWrapping="Wrap" AcceptsReturn="True"
                     MinHeight="200" Background="#F8FAFC" />
          </DockPanel>
        </DockPanel>
      </Border>

    </Panel>
  </DockPanel>
</UserControl>
