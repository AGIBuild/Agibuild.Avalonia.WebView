<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:Agibuild.Avalonia.WebView.Integration.Tests.ViewModels"
             xmlns:agw="using:Agibuild.Avalonia.WebView"
             xmlns:views="using:Agibuild.Avalonia.WebView.Integration.Tests.Views"
             mc:Ignorable="d"
             x:Class="Agibuild.Avalonia.WebView.Integration.Tests.Views.FeatureE2EView"
             x:DataType="vm:FeatureE2EViewModel"
             Background="{StaticResource SurfaceBgBrush}">

  <UserControl.Resources>
    <views:TestResultBrushConverter x:Key="ResultBrush" />
  </UserControl.Resources>

  <DockPanel>

    <!-- ════════════ Top Toolbar ════════════ -->
    <Border DockPanel.Dock="Top" Background="White"
            BorderThickness="0,0,0,1" BorderBrush="{StaticResource BorderDefaultBrush}"
            Padding="6,4">
      <Grid ColumnDefinitions="Auto,*,Auto,Auto,Auto">
        <ToggleButton x:Name="ToolsToggle" Grid.Column="0"
                      IsChecked="True"
                      Content="&#x2630;" ToolTip.Tip="Test Dashboard"
                      FontSize="14" Padding="8,5"
                      Background="Transparent" BorderThickness="0"
                      CornerRadius="6" VerticalAlignment="Center" />
        <TextBlock Grid.Column="1" Text="Feature E2E Test Runner"
                   FontWeight="SemiBold" FontSize="13"
                   Foreground="{StaticResource TextPrimaryBrush}"
                   VerticalAlignment="Center" Margin="8,0" />
        <Border Grid.Column="2" CornerRadius="6" Padding="8,3"
                Background="#F0F9FF" VerticalAlignment="Center" Margin="0,0,8,0">
          <TextBlock Text="{Binding Status}" FontSize="11" FontWeight="SemiBold"
                     Foreground="#1E40AF" />
        </Border>
        <Button Grid.Column="3"
                Content="&#x1F527; DevTools"
                Command="{Binding OpenDevToolsCommand}"
                ToolTip.Tip="Open DevTools (F12 / Cmd+Shift+I)"
                Padding="10,5" FontSize="11" Margin="0,0,6,0"
                Background="Transparent" BorderThickness="1"
                BorderBrush="{StaticResource BorderDefaultBrush}"
                CornerRadius="6" VerticalAlignment="Center" />
        <Button Grid.Column="4" Classes="primary"
                Content="&#x25B6; Run All"
                Command="{Binding RunAllCommand}"
                Padding="12,5" FontSize="11" />
      </Grid>
    </Border>

    <!-- ════════════ Content: Left Panel + WebView ════════════ -->
    <Grid ColumnDefinitions="Auto,*">

      <!-- Left test dashboard panel (inline, collapsible) -->
      <Border Grid.Column="0" Width="200"
              IsVisible="{Binding #ToolsToggle.IsChecked}"
              Background="White"
              BorderThickness="0,0,1,0" BorderBrush="{StaticResource BorderDefaultBrush}">
        <DockPanel>
          <TextBlock DockPanel.Dock="Top" Text="Test Results" FontWeight="SemiBold" FontSize="12"
                     Foreground="{StaticResource TextSecondaryBrush}"
                     Margin="10,8,10,6" />
          <ScrollViewer Margin="6,0,6,6">
            <StackPanel Spacing="4">

              <!-- Test result cards (vertical list) -->
              <Border CornerRadius="6" Padding="10,6"
                      Background="{Binding ResultCommand, Converter={StaticResource ResultBrush}, ConverterParameter=bg}">
                <Grid ColumnDefinitions="*,Auto">
                  <TextBlock Text="Command" FontSize="12" FontWeight="SemiBold"
                             Foreground="{StaticResource TextPrimaryBrush}" />
                  <TextBlock Grid.Column="1" Text="{Binding ResultCommand}" FontSize="11" FontWeight="Bold"
                             Foreground="{Binding ResultCommand, Converter={StaticResource ResultBrush}, ConverterParameter=fg}" />
                </Grid>
              </Border>

              <Border CornerRadius="6" Padding="10,6"
                      Background="{Binding ResultScreenshot, Converter={StaticResource ResultBrush}, ConverterParameter=bg}">
                <Grid ColumnDefinitions="*,Auto">
                  <TextBlock Text="Screenshot" FontSize="12" FontWeight="SemiBold"
                             Foreground="{StaticResource TextPrimaryBrush}" />
                  <TextBlock Grid.Column="1" Text="{Binding ResultScreenshot}" FontSize="11" FontWeight="Bold"
                             Foreground="{Binding ResultScreenshot, Converter={StaticResource ResultBrush}, ConverterParameter=fg}" />
                </Grid>
              </Border>

              <Border CornerRadius="6" Padding="10,6"
                      Background="{Binding ResultPdf, Converter={StaticResource ResultBrush}, ConverterParameter=bg}">
                <Grid ColumnDefinitions="*,Auto">
                  <TextBlock Text="PDF" FontSize="12" FontWeight="SemiBold"
                             Foreground="{StaticResource TextPrimaryBrush}" />
                  <TextBlock Grid.Column="1" Text="{Binding ResultPdf}" FontSize="11" FontWeight="Bold"
                             Foreground="{Binding ResultPdf, Converter={StaticResource ResultBrush}, ConverterParameter=fg}" />
                </Grid>
              </Border>

              <Border CornerRadius="6" Padding="10,6"
                      Background="{Binding ResultRpc, Converter={StaticResource ResultBrush}, ConverterParameter=bg}">
                <Grid ColumnDefinitions="*,Auto">
                  <TextBlock Text="RPC" FontSize="12" FontWeight="SemiBold"
                             Foreground="{StaticResource TextPrimaryBrush}" />
                  <TextBlock Grid.Column="1" Text="{Binding ResultRpc}" FontSize="11" FontWeight="Bold"
                             Foreground="{Binding ResultRpc, Converter={StaticResource ResultBrush}, ConverterParameter=fg}" />
                </Grid>
              </Border>

              <Border CornerRadius="6" Padding="10,6"
                      Background="{Binding ResultFind, Converter={StaticResource ResultBrush}, ConverterParameter=bg}">
                <Grid ColumnDefinitions="*,Auto">
                  <TextBlock Text="Find" FontSize="12" FontWeight="SemiBold"
                             Foreground="{StaticResource TextPrimaryBrush}" />
                  <TextBlock Grid.Column="1" Text="{Binding ResultFind}" FontSize="11" FontWeight="Bold"
                             Foreground="{Binding ResultFind, Converter={StaticResource ResultBrush}, ConverterParameter=fg}" />
                </Grid>
              </Border>

              <Border CornerRadius="6" Padding="10,6"
                      Background="{Binding ResultZoom, Converter={StaticResource ResultBrush}, ConverterParameter=bg}">
                <Grid ColumnDefinitions="*,Auto">
                  <TextBlock Text="Zoom" FontSize="12" FontWeight="SemiBold"
                             Foreground="{StaticResource TextPrimaryBrush}" />
                  <TextBlock Grid.Column="1" Text="{Binding ResultZoom}" FontSize="11" FontWeight="Bold"
                             Foreground="{Binding ResultZoom, Converter={StaticResource ResultBrush}, ConverterParameter=fg}" />
                </Grid>
              </Border>

              <Border CornerRadius="6" Padding="10,6"
                      Background="{Binding ResultPreload, Converter={StaticResource ResultBrush}, ConverterParameter=bg}">
                <Grid ColumnDefinitions="*,Auto">
                  <TextBlock Text="Preload" FontSize="12" FontWeight="SemiBold"
                             Foreground="{StaticResource TextPrimaryBrush}" />
                  <TextBlock Grid.Column="1" Text="{Binding ResultPreload}" FontSize="11" FontWeight="Bold"
                             Foreground="{Binding ResultPreload, Converter={StaticResource ResultBrush}, ConverterParameter=fg}" />
                </Grid>
              </Border>

              <Border CornerRadius="6" Padding="10,6"
                      Background="{Binding ResultContext, Converter={StaticResource ResultBrush}, ConverterParameter=bg}">
                <Grid ColumnDefinitions="*,Auto">
                  <TextBlock Text="Context" FontSize="12" FontWeight="SemiBold"
                             Foreground="{StaticResource TextPrimaryBrush}" />
                  <TextBlock Grid.Column="1" Text="{Binding ResultContext}" FontSize="11" FontWeight="Bold"
                             Foreground="{Binding ResultContext, Converter={StaticResource ResultBrush}, ConverterParameter=fg}" />
                </Grid>
              </Border>

              <Border CornerRadius="6" Padding="10,6"
                      Background="{Binding ResultBridge, Converter={StaticResource ResultBrush}, ConverterParameter=bg}">
                <Grid ColumnDefinitions="*,Auto">
                  <TextBlock Text="Bridge" FontSize="12" FontWeight="SemiBold"
                             Foreground="{StaticResource TextPrimaryBrush}" />
                  <TextBlock Grid.Column="1" Text="{Binding ResultBridge}" FontSize="11" FontWeight="Bold"
                             Foreground="{Binding ResultBridge, Converter={StaticResource ResultBrush}, ConverterParameter=fg}" />
                </Grid>
              </Border>

              <Border CornerRadius="6" Padding="10,6"
                      Background="{Binding ResultDevTools, Converter={StaticResource ResultBrush}, ConverterParameter=bg}">
                <Grid ColumnDefinitions="*,Auto">
                  <TextBlock Text="DevTools" FontSize="12" FontWeight="SemiBold"
                             Foreground="{StaticResource TextPrimaryBrush}" />
                  <TextBlock Grid.Column="1" Text="{Binding ResultDevTools}" FontSize="11" FontWeight="Bold"
                             Foreground="{Binding ResultDevTools, Converter={StaticResource ResultBrush}, ConverterParameter=fg}" />
                </Grid>
              </Border>

            </StackPanel>
          </ScrollViewer>
        </DockPanel>
      </Border>

      <!-- WebView (fills remaining space) -->
      <agw:WebView Grid.Column="1" x:Name="WebViewControl" Source="about:blank" />

    </Grid>
  </DockPanel>
</UserControl>
