<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Avalonia + React Hybrid Demo</title>
  </head>
  <body class="bg-white dark:bg-gray-950 text-gray-900 dark:text-gray-100">
    <div id="root"></div>
    <script>
      // Standalone mock: when running in browser without Avalonia host, inject a minimal bridge
      // so the SPA can render (e.g. for dev preview or screenshots).
      (function () {
        if (typeof window !== 'undefined' && !window.agWebView?.rpc) {
          const handlers = {};
          window.agWebView = {
            rpc: {
              invoke: function (method, params) {
                if (method === 'AppShellService.getPages') {
                  return Promise.resolve([
                    { id: 'dashboard', title: 'Dashboard', icon: 'LayoutDashboard', route: '/dashboard' },
                    { id: 'chat', title: 'Chat', icon: 'MessageSquare', route: '/chat' },
                    { id: 'files', title: 'Files', icon: 'FolderOpen', route: '/files' },
                    { id: 'settings', title: 'Settings', icon: 'Settings', route: '/settings' }
                  ]);
                }
                if (method === 'AppShellService.getAppInfo') {
                  return Promise.resolve({ name: 'Hybrid Demo', version: '1.0', description: '' });
                }
                if (method === 'SettingsService.getSettings') {
                  return Promise.resolve({
                    theme: 'light', language: 'en', fontSize: 14, sidebarCollapsed: false
                  });
                }
                if (method === 'SettingsService.updateSettings') {
                  return Promise.resolve(params?.settings ?? {});
                }
                if (method === 'ChatService.getHistory') return Promise.resolve([]);
                if (method === 'ChatService.sendMessage') {
                  const req = params?.request ?? {};
                  return Promise.resolve({
                    id: crypto.randomUUID(),
                    message: 'Echo: ' + (req.message || ''),
                    timestamp: new Date().toISOString()
                  });
                }
                if (method === 'ChatService.clearHistory') return Promise.resolve();
                if (method === 'FileService.listFiles') return Promise.resolve([]);
                if (method === 'FileService.readTextFile') return Promise.resolve('');
                if (method === 'FileService.getUserDocumentsPath') return Promise.resolve('/Documents');
                if (method === 'SystemInfoService.getSystemInfo') {
                  return Promise.resolve({ osName: 'Web', osVersion: '', dotnetVersion: '', avaloniaVersion: '', machineName: 'browser', processorCount: 0, totalMemoryMb: 0, webViewEngine: 'standalone' });
                }
                if (method === 'SystemInfoService.getRuntimeMetrics') {
                  return Promise.resolve({ workingSetMb: 0, gcTotalMemoryMb: 0, threadCount: 0, uptimeSeconds: 0 });
                }
                return Promise.reject(new Error('Unknown method: ' + method));
              },
              handle: function (method, handler) { handlers[method] = handler; }
            }
          };
        }
      })();
    </script>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
