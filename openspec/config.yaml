schema: spec-driven

context: |
  Project: Agibuild.Fulora — Cross-platform hybrid app framework for Avalonia UI.
  Vision: "Electron's developer productivity + native performance and footprint."
  See openspec/PROJECT.md for full goals; openspec/ROADMAP.md for phased delivery plan.

  Tech stack: C# / .NET 10, Avalonia UI, System.Text.Json, Roslyn Source Generators
  Platforms: Windows (WebView2), macOS/iOS (WKWebView), Android (WebView), Linux (WebKitGTK)
  Architecture: Contract-driven with MockAdapter for testing; facet-based adapter extensibility
  Tests: xUnit, 525 CT + 80 IT, 96%+ line coverage
  CI: GitHub Actions (macOS + Windows + Linux), NuGet release via Nuke build

  Current phase: Phase 3 — Polish & General Availability
  Key goals: G1 (Type-Safe Bridge), G2 (SPA Hosting), G3 (Secure by Default), G4 (Testability)

  Conventions:
    - Code and comments in English; chat responses in Chinese
    - Contract-first: define interfaces + specs before implementation
    - All features must be testable via MockAdapter without real browser
    - Security is architectural: bridge exposes only explicit methods, policy pipeline filters all messages

  CRITICAL CONSTRAINT — Alignment with project vision:
    - Before creating any new spec, change, or recommending next tasks, ALWAYS read:
        1. openspec/PROJECT.md (goals, non-goals, competitive positioning)
        2. openspec/ROADMAP.md (current phase, deliverables, dependencies)
        3. docs/agibuild_webview_design_doc.md (architecture, contracts, design principles)
    - Every new spec/change MUST trace back to a Goal ID (G1-G4, E1-E3, F1-F8) or a ROADMAP deliverable
    - If a proposed task does NOT align with PROJECT.md goals or ROADMAP.md phases, explicitly flag it as out-of-scope and ask for confirmation before proceeding
    - When recommending next tasks, prioritize items from the current ROADMAP phase before suggesting anything else

rules:
  proposal:
    - MUST read openspec/PROJECT.md and openspec/ROADMAP.md before drafting
    - Reference the relevant Goal ID (G1-G4, E1-E3) from PROJECT.md
    - Reference the relevant ROADMAP.md phase and deliverable number
    - Explain how this proposal advances the current phase
    - Include a "Non-goals" section
    - Keep proposals under 500 words
    - If the proposal does not fit any ROADMAP deliverable, justify why it should be done now
  design:
    - MUST read openspec/ROADMAP.md and docs/agibuild_webview_design_doc.md before drafting
    - Reference the relevant ROADMAP.md phase and deliverable numbers
    - Verify the design is consistent with docs/agibuild_webview_design_doc.md architecture
    - Include testing strategy (CT/IT/MockBridge)
  tasks:
    - Break tasks into chunks of max 2 hours
    - Each task must have clear acceptance criteria
    - Each task must reference the deliverable it implements
